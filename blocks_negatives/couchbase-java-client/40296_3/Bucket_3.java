    * Upsert a {@link Document}.
    *
    * @param document the document to upsert.
    * @param <D> the type of the document, which is inferred from the instance.
    * @return the document again.
    */
